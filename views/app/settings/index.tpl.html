<div class="modal fade" id="removeuserModal" tabindex="-1" role="dialog" aria-labelledby="removeusersModalLabel" aria-hidden="true">
  <div class="modal-dialog ">
    <div class="modal-content">
      <div class="modal-header">
        <h2>删除用户？</h2>
      </div>
      <div class="modal-body">
        <div class="alert alert-warning">确定删除用户？</div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-danger" type="button" data-dismiss="modal" ng-click="confirmRemoveUser()">删除</button>
        <button class="btn btn-default" data-dismiss="modal" type="button">取消</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="toadminModal" tabindex="-1" role="dialog" aria-labelledby="toadminsModalLabel" aria-hidden="true">
  <div class="modal-dialog ">
    <div class="modal-content">
      <div class="modal-header">
        <h2>提升为管理员？</h2>
      </div>
      <div class="modal-body">
        <div class="alert alert-warning">确定提升为管理员？</div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-success" type="button" data-dismiss="modal" ng-click="confirmToadmin()">确定</button>
        <button class="btn btn-default" data-dismiss="modal" type="button">取消</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="toVipModal" tabindex="-1" role="dialog" aria-labelledby="toVipsModalLabel" aria-hidden="true">
  <div class="modal-dialog ">
    <div class="modal-content">
      <div class="modal-header">
        <h2>提升为付费用户？</h2>
      </div>
      <div class="modal-body">
        <div class="alert alert-warning">确定提升为付费用户？</div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-success" type="button" data-dismiss="modal" ng-click="confirmToVip()">确定</button>
        <button class="btn btn-default" data-dismiss="modal" type="button">取消</button>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid">
  <div class="row-fluid">
    <div class="span12">
      <div class="panel panel-default panel-primary">
        <div class="panel-heading ">
          <div class="row">
            <div class="col-md-1">
              <h5>
                <span class="label label-default">
                  <i class="icon-chevron-down icon-white"></i>
                  个人信息
                </span>
              </h5>
            </div>
          </div>
          <!--row-->
        </div>
        <!--heading-->
        <div class="panel-body">
          <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
            <div class="panel panel-default">
              <div class="panel-heading" role="tab" id="headingOne">
                <h4 class="panel-title">
                  <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                    基本信息
                  </a>
                </h4>
              </div>
              <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
                <div class="panel-body">
                  <div class="container-fluid">
                    <div class="row">
                      <form class="form-horizontal">
                        <div class="form-group">
                          <label class="control-label col-md-1">用户名</label>
                          <label class="control-label col-md-2">{{currentUser.username}}</label>
                        </div>
                        <div class="form-group">
                          <label class="control-label col-md-1">邮箱</label>
                          <label class="control-label col-md-2">{{currentUser.email}}</label>
                        </div>
                        <div class="form-group" ng-init="passwdEdit=false">
                          <label class="control-label col-md-1">密码</label>
                          <label class="control-label col-md-2" ng-hide="passwdEdit">********</label>
                          <input type="password" placeholder="原密码" class="control-label col-md-1" ng-model="password" ng-show="passwdEdit" />
                          <input type="password" placeholder="新密码" class="control-label col-md-1" ng-model="npassword" ng-show="passwdEdit" />
                          <a class="btn btn-default btn-sm" ng-click="passwdEdit=!passwdEdit" ng-hide="passwdEdit">
                            <span class="glyphicon glyphicon-edit"></span>
                          </a>
                          <a class="btn btn-success btn-sm" ng-click="passwdEdit=!passwdEdit;passwd()" ng-show="passwdEdit">
                            <span class="glyphicon glyphicon-ok-circle">保存</span>
                          </a>
                          <a class="btn btn-danger btn-sm" ng-click="passwdEdit=!passwdEdit" ng-show="passwdEdit">
                            <span class="glyphicon glyphicon-remove-circle">取消</span>
                          </a>
                        </div>
                        <div class="form-group">
                          <label class="control-label col-md-1">会员状态</label>
                          <label class="control-label col-md-2">{{viptype}}</label>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="panel panel-default">
              <div class="panel-heading" role="tab" id="headingTwo">
                <h4 class="panel-title">
                  <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                    详细信息
                  </a>
                </h4>
              </div>
              <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
                <div class="panel-body">
                  <div class="container-fluid">
                    <div class="row">
                      <form class="form-horizontal">
                        <div class="form-group" ng-init="firstNameEdit=false;first_name=currentUser.first_name">
                          <label class="control-label col-md-1">姓名</label>
                          <div class="col-md-3">
                            <input type="text" class="form-control" ng-show="firstNameEdit" ng-model="first_name" />
                            <label class="control-label " ng-hide="firstNameEdit">{{currentUser.first_name}}</label>
                          </div>
                          <a class="btn btn-default btn-sm" ng-click="firstNameEdit=!firstNameEdit;editUser('first_name')" ng-hide="firstNameEdit">
                            <span class="glyphicon glyphicon-edit"></span>
                          </a>
                          <a class="btn btn-success btn-sm" ng-click="firstNameEdit=!firstNameEdit;saveUser(first_name)" ng-show="firstNameEdit">
                            <span class="glyphicon glyphicon-ok-circle">保存</span>
                          </a>
                          <a class="btn btn-danger btn-sm" ng-click="firstNameEdit=!firstNameEdit" ng-show="firstNameEdit">
                            <span class="glyphicon glyphicon-remove-circle">取消</span>
                          </a>
                        </div>
                        <div class="form-group" ng-init="sexEdit=false;detail_sex=currentUser.detail_sex">
                          <label class="control-label col-md-1">性别</label>
                          <div class="col-md-3">
                            <input type="text" class="form-control" ng-show="sexEdit" ng-model="detail_sex" />
                            <label class="control-label " ng-hide="sexEdit">{{currentUser.detail_sex}}</label>
                          </div>
                          <a class="btn btn-default btn-sm" ng-click="sexEdit=!sexEdit;editUser('detail_sex')" ng-hide="sexEdit">
                            <span class="glyphicon glyphicon-edit"></span>
                          </a>
                          <a class="btn btn-success btn-sm" ng-click="sexEdit=!sexEdit;saveUser(detail_sex)" ng-show="sexEdit">
                            <span class="glyphicon glyphicon-ok-circle">保存</span>
                          </a>
                          <a class="btn btn-danger btn-sm" ng-click="sexEdit=!sexEdit" ng-show="sexEdit">
                            <span class="glyphicon glyphicon-remove-circle">取消</span>
                          </a>
                        </div>
                        <div class="form-group" ng-init="eduEdit=false;detail_edu=currentUser.detail_edu">
                          <label class="control-label col-md-1">教育程度</label>
                          <div class="col-md-3">
                            <input type="text" class="form-control" ng-show="eduEdit" ng-model="detail_edu" />
                            <label class="control-label " ng-hide="eduEdit">{{currentUser.detail_edu}}</label>
                          </div>
                          <a class="btn btn-default btn-sm" ng-click="eduEdit=!eduEdit;editUser('detail_edu')" ng-hide="eduEdit">
                            <span class="glyphicon glyphicon-edit"></span>
                          </a>
                          <a class="btn btn-success btn-sm" ng-click="eduEdit=!eduEdit;saveUser(detail_edu)" ng-show="eduEdit">
                            <span class="glyphicon glyphicon-ok-circle">保存</span>
                          </a>
                          <a class="btn btn-danger btn-sm" ng-click="eduEdit=!eduEdit" ng-show="eduEdit">
                            <span class="glyphicon glyphicon-remove-circle">取消</span>
                          </a>
                        </div>
                        <div class="form-group" ng-init="birthdayEdit=false;detail_birthday=currentUser.detail_birthday">
                          <label class="control-label col-md-1">出生日期</label>
                          <div class="col-md-3">
                            <input type="text" class="form-control" ng-show="birthdayEdit" ng-model="detail_birthday" />
                            <label class="control-label " ng-hide="birthdayEdit">{{currentUser.detail_birthday}}</label>
                          </div>
                          <a class="btn btn-default btn-sm" ng-click="birthdayEdit=!birthdayEdit;editUser('detail_birthday')" ng-hide="birthdayEdit">
                            <span class="glyphicon glyphicon-edit"></span>
                          </a>
                          <a class="btn btn-success btn-sm" ng-click="birthdayEdit=!birthdayEdit;saveUser(detail_birthday)" ng-show="birthdayEdit">
                            <span class="glyphicon glyphicon-ok-circle">保存</span>
                          </a>
                          <a class="btn btn-danger btn-sm" ng-click="birthdayEdit=!birthdayEdit" ng-show="birthdayEdit">
                            <span class="glyphicon glyphicon-remove-circle">取消</span>
                          </a>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="panel panel-default">
              <div class="panel-heading" role="tab" id="headingThree">
                <h4 class="panel-title">
                  <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                    联系方式
                  </a>
                </h4>
              </div>
              <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
                <div class="panel-body">
                  <div class="container-fluid">
                    <div class="row">
                      <form class="form-horizontal">
                        <div class="form-group" ng-init="cellphone=false;detail_cellnumber=currentUser.detail_cellnumber">
                          <label class="control-label col-md-1">手机</label>
                          <div class="col-md-3">
                            <input type="text" class="form-control" ng-show="cellphone" ng-model="detail_cellnumber" />
                            <label class="control-label " ng-hide="cellphone">{{currentUser.detail_cellnumber}}</label>
                          </div>
                          <a class="btn btn-default btn-sm" ng-click="cellphone=!cellphone;editUser('detail_cellnumber')" ng-hide="cellphone">
                            <span class="glyphicon glyphicon-edit"></span>
                          </a>
                          <a class="btn btn-success btn-sm" ng-click="cellphone=!cellphone;saveUser(detail_cellnumber)" ng-show="cellphone">
                            <span class="glyphicon glyphicon-ok-circle">保存</span>
                          </a>
                          <a class="btn btn-danger btn-sm" ng-click="cellphone=!cellphone" ng-show="cellphone">
                            <span class="glyphicon glyphicon-remove-circle">取消</span>
                          </a>
                        </div>
                        <div class="form-group" ng-init="phonenumber=false;detail_phonenumber=currentUser.detail_phonenumber">
                          <label class="control-label col-md-1">电话</label>
                          <div class="col-md-3">
                            <input type="text" class="form-control" ng-show="phonenumber" ng-model="detail_phonenumber" />
                            <label class="control-label " ng-hide="phonenumber">{{currentUser.detail_phonenumber}}</label>
                          </div>
                          <a class="btn btn-default btn-sm" ng-click="phonenumber=!phonenumber;editUser('detail_phonenumber')" ng-hide="phonenumber">
                            <span class="glyphicon glyphicon-edit"></span>
                          </a>
                          <a class="btn btn-success btn-sm" ng-click="phonenumber=!phonenumber;saveUser(detail_phonenumber)" ng-show="phonenumber">
                            <span class="glyphicon glyphicon-ok-circle">保存</span>
                          </a>
                          <a class="btn btn-danger btn-sm" ng-click="phonenumber=!phonenumber" ng-show="phonenumber">
                            <span class="glyphicon glyphicon-remove-circle">取消</span>
                          </a>
                        </div>
                        <div class="form-group" ng-init="cityEdit=false;detail_city=currentUser.detail_city">
                          <label class="control-label col-md-1">城市</label>
                          <div class="col-md-3">
                            <input type="text" class="form-control" ng-show="cityEdit" ng-model="detail_city" />
                            <label class="control-label " ng-hide="cityEdit">{{currentUser.detail_city}}</label>
                          </div>
                          <a class="btn btn-default btn-sm" ng-click="cityEdit=!cityEdit;editUser('detail_city')" ng-hide="cityEdit">
                            <span class="glyphicon glyphicon-edit"></span>
                          </a>
                          <a class="btn btn-success btn-sm" ng-click="cityEdit=!cityEdit;saveUser(detail_city)" ng-show="cityEdit">
                            <span class="glyphicon glyphicon-ok-circle">保存</span>
                          </a>
                          <a class="btn btn-danger btn-sm" ng-click="cityEdit=!cityEdit" ng-show="cityEdit">
                            <span class="glyphicon glyphicon-remove-circle">取消</span>
                          </a>
                        </div>
                        <div class="form-group" ng-init="workplaceEdit=false;detail_workplace=currentUser.detail_workplace">
                          <label class="control-label col-md-1">工作单位</label>
                          <div class="col-md-3">
                            <input type="text" class="form-control" ng-show="workplaceEdit" ng-model="detail_workplace" />
                            <label class="control-label " ng-hide="workplaceEdit">{{currentUser.detail_workplace}}</label>
                          </div>
                          <a class="btn btn-default btn-sm" ng-click="workplaceEdit=!workplaceEdit;editUser('detail_workplace')" ng-hide="workplaceEdit">
                            <span class="glyphicon glyphicon-edit"></span>
                          </a>
                          <a class="btn btn-success btn-sm" ng-click="workplaceEdit=!workplaceEdit;saveUser(detail_workplace)" ng-show="workplaceEdit">
                            <span class="glyphicon glyphicon-ok-circle">保存</span>
                          </a>
                          <a class="btn btn-danger btn-sm" ng-click="workplaceEdit=!workplaceEdit" ng-show="workplaceEdit">
                            <span class="glyphicon glyphicon-remove-circle">取消</span>
                          </a>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="panel panel-default" ng-show="currentUser.isadmin=='true'">
              <div class="panel-heading" role="tab" id="headingFour">
                <h4 class="panel-title">
                  <a class="collapsed" data-toggle="collapse" data-parent="#accordion" href="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                    会员管理
                  </a>
                </h4>
              </div>
              <div id="collapseFour" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingFour">
                <div class="panel-body">
                  <div class="well form-horizontal">
                    <div class="form-group">
                      <label class="control-label col-md-1">用户总数</label>
                      <label class="control-label col-md-2">{{usercount}}</label>
                    </div>
                    <div class="form-group">
                      <label class="control-label col-md-1">会员总数</label>
                      <label class="control-label col-md-2">{{vipusercount}}</label>
                    </div>
                  </div>
                </div>
                <div class="container-fluid">
                  <div class=" scrollbar">
                    <table class="table table-striped table-bordered table-hover table-responsive table-condensed" id="user_table">
                      <thead>
                        <tr>
                          <th>编号</th>
                          <th class="title sorting">用户名</th>
                          <th class="description visible-desktop sorting">邮箱</th>
                          <th class="owner visible-desktop sorting">会员状态</th>
                          <th class="owner visible-desktop sorting">管理权限</th>
                          <th class="created visible-desktop sorting">注册时间</th>
                        </tr>
                      </thead>

                      <tbody>
                        <tr ng-repeat="user in users.data|filter:search">
                          <td>{{user.id}}</td>
                          <td ng-mouseenter="btnShow=true" ng-mouseleave="btnShow=false" ng-init="btnShow=false">
                            {{user.username}}
                            <div class=" pull-right" ng-show="btnShow&&user.id!=1">
                              <!--按钮-->
                              <div class="btn-group">
                                <a class="btn btn-primary btn-sm" ng-click="removeuser(user)" data-target="#removeuserModal" data-toggle="modal">
                                  <span class="glyphicon glyphicon-trash"></span>
                                </a>
                              </div>
                            </div>
                          </td>
                          <td class="visible-desktop description">
                            <div class="check-height">{{user.email}}
                              <span class="label label-success pull-right" ng-show="user.activated">已验证</span>
                              <span class="label label-warning pull-right" ng-hide="user.activated">未验证</span>
                            </div>
                          </td>
                          <td ng-mouseenter="toVipBtn=true" ng-mouseleave="toVipBtn=false" ng-init="toVipBtn=false">
                            <a href="user/{{user.id}}" target="_Blank">{{user.isViptype?'付费会员':'免费会员'}}</a>
                            <div class=" pull-right" ng-show="toVipBtn&&(!user.isViptype)">
                              <!--按钮-->
                              <div class="btn-group">
                                <a class="btn btn-success btn-sm" ng-click="usertovip(user)" data-target="#toVipModal" data-toggle="modal">
                                  <span class="glyphicon glyphicon-upload"></span>
                                </a>
                              </div>
                            </div>
                          </td>
                          <td ng-mouseenter="toadmin=true" ng-mouseleave="toadmin=false" ng-init="toadmin=false">
                            <a href="user/{{user.id}}" target="_Blank">{{user.isadmin?'管理员':'非管理员'}}</a>
                            <div class=" pull-right" ng-show="toadmin&&(!user.isadmin)">
                              <!--按钮-->
                              <div class="btn-group">
                                <a class="btn btn-success btn-sm" ng-click="usertoadmin(user)" data-target="#toadminModal" data-toggle="modal">
                                  <span class="glyphicon glyphicon-upload"></span>
                                </a>
                              </div>
                            </div>
                          </td>
                          <td class="visible-desktop created"><span>{{user.createdAt | amDateFormat:'YYYY年MM月DD日 HH:mm:ss'}}</span></td>
                        </tr>
                      </tbody>
                    </table>

                    <div class="panel-footer">
                      <nav>
                        <ul class="pager">
                          <li>
                            <select ng-options="limit for limit in limits" ng-model="paginator.limit" ng-change="pageChanged(1)">项/页
                            </select>
                          </li>
                          <li><a ng-click="firstPage()">第一页</a></li>
                          <li><a ng-click="prePage()">上一页</a></li>
                          <li><a>第 {{ paginator.page }} / {{ paginator.total_pages }}页</a></li>
                          <li><a ng-click="nextPage()">下一页</a></li>
                          <li><a ng-click="lastPage()">最后一页</a></li>
                        </ul>
                      </nav>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
